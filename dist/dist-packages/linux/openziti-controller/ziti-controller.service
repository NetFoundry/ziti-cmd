[Unit]
Description=OpenZiti Controller
After=network-online.target

[Service]
# "ziti controller run" is the main process managed by this service and replaces entrypoint.bash
Type=simple

# manage the user and permissions for the service automatically
DynamicUser=yes

# allow binding low ports, e.g., 443/tcp
AmbientCapabilities=CAP_NET_BIND_SERVICE

# load password from a file; set owner to root and chmod 0400 for security
LoadCredential=ZITI_PWD:/opt/openziti/etc/controller/.pwd
# or set a password as literal string
# SetCredential=ZITI_PWD:admin

UMask=0007
Restart=always
RestartSec=3
LimitNOFILE=65535

# relative to /var/lib
StateDirectory=ziti-controller

# absolute path where service will be run
WorkingDirectory=/var/lib/ziti-controller

# used by bootstrap.bash to look up /run/credentials/$UNIT_NAME/$CREDENTIAL_NAME
Environment=UNIT_NAME=ziti-controller.service
EnvironmentFile=/opt/openziti/etc/controller/env

ExecStart=/opt/openziti/etc/controller/entrypoint.bash

[Install]
WantedBy=multi-user.target
